function Documentron(opts){var opts=opts||{};this.opts=$.extend({srcObj:void 0,url:void 0,srcTxt:void 0,templateEngine:function(e,t,r){return r.simpleTmplParser(e,t)},onSuccess:function(){},onError:function(e){throw new Error("Error! "+e)}},opts);var that=this;this.attFlagsRegex=/\[(.+)\]/,this.doc={},this.meta={},this.shared={},this.raw="",this.srcType="url",this.attTypeRegex=/\{(.+)\}/,this.init=function(){this.determineSrcType()},this.determineSrcType=function(){void 0!=this.opts.srcObj&&$.isPlainObject(this.opts.srcObj)?(this.srcType="srcObj",this.doc=this.opts.srcObj,this.raw=JSON.stringify(this.opts.srcObj,null,3),this.opts.onSuccess(this.doc,this)):void 0!=this.opts.srcTxt&&"string"==typeof this.opts.srcTxt?(this.srcType="srcTxt",this.raw=this.opts.srcTxt,this.parseJS(this.opts.srcTxt),this.opts.onSuccess(this.doc,this)):void 0!=this.opts.url&&"string"==typeof this.opts.url?(this.doc=this.opts.url,this.readJS(this.opts.url)):void 0!=this.opts.srcObj?this.opts.onError("Could not parse srcObj. Check that object."):void 0!=this.opts.srcTxt?this.opts.onError("Could not parse srcTxt. Check that raw text."):void 0!=this.opts.url?this.opts.onError("Problem with url. Check that url."):void 0==this.opts.srcTxt&&void 0==this.opts.srObj&&void 0==this.opts.url&&this.opts.onError("Could not find srcType: Use srcObj, srcTxt, or url as an option to pull data from.")},this.safeTrim=function(e){return"string"==typeof e?e.trim():e},this.removeCommentLines=function(e){var t=this;return this.eachLine(e,function(e){return t.safeTrim(e).startsWith("***")?!1:e})},this.sortByGroups=function(obj){var retObj={_other_:[]};return obj=obj||this.doc,$.each(obj,function(k,v){if(void 0!=v.group&&""!=that.safeTrim(v.group)){var tmpStr="";$.each(v.group.split("."),function(k2,v2){tmpStr+="."+v2,void 0==eval("retObj"+tmpStr)&&eval("retObj"+tmpStr+" = {}")}),eval("retObj."+that.safeTrim(v.group)+"[k] = v")}else retObj._other_.push(v)}),0==retObj._other_.length&&delete retObj._other_,retObj},this.toObject=function(e,t){var t=t||this.doc,e=e||{};e=$.extend(!0,{sortByGroup:!1,excludeMeta:!1,filter:!1,linkFormat:!0,externalLinkFormat:!0},e);var r=$.extend({},{doc:t,meta:this.meta});return e.excludeMeta&&delete r.meta,e.filter&&(r.doc=this.filter(e.filter,r.doc)),0!=e.sortByGroup&&(r.doc=this.sortByGroups(r.doc)),e.linkFormat&&(r.doc=this.hashesToLinks(r.doc,e.linkFormat)),e.externalLinkFormat&&(r.doc=this.externalLinkify(r.doc,e.externalLinkFormat)),e.excludeMeta&&delete r.meta,r},this.toDataURI=function(e,t){var t=t||this.doc,e=e||{};e=$.extend({indent:3},e);var r=this.toObject(e,t);return this._dataURI(JSON.stringify(r,null,e.indent))},this._dataURI=function(e){return"data:text/plain;base64,"+encodeURIComponent(btoa(e))},this.getByTags=function(e){var t,r=e.split(","),a={};return $.each(r,function(e,r){r=that.safeTrim(r),$.each(that.doc,function(e,n){n.tags&&(t=n.tags.split(","),$.each(t,function(t,s){that.safeTrim(s)==that.safeTrim(r)&&void 0==a[e]&&(a[e]=n)}))})}),a},this.getExampleById=function(e){var t=!1;return $.each(this.doc,function(r,a){void 0!=a.example&&$.each(a.example,function(r,a){that.safeTrim(a.id)==that.safeTrim(e)&&(t=a)})}),t},this.getGroup=function(x){var groups=this.sortByGroups();return void 0!=eval("groups."+x)?eval("groups."+x):!1},this._filters={groupOnly:function(e,t){if(void 0==t.group)return!1;var r,a=!1;return $.each(e.split(","),function(e,n){n=that.safeTrim(n),r=new RegExp("^"+n.replace(/\./g,"\\.").replace(/\*/g,"(.+)")+"$"),t.group.match(r)&&(a=!0)}),a},groupIgnore:function(e,t){if(void 0==t.group)return!1;var r,a=!0;return $.each(e.split(","),function(e,n){n=that.safeTrim(n),r=new RegExp("^"+n.replace(/\./g,"\\.").replace(/\*/g,"(.+)")+"$"),t.group.match(r)&&(a=!1)}),a},only:function(e,t){e.split(",");return-1!=e.indexOf(t.name)},ignore:function(e,t){e.split(",");return-1==e.indexOf(t.name)}},this.filter=function(e,t){t=t||this.doc;var r=$.extend(!0,{},t);return $.each(this._filters,function(t,a){void 0!=e[t]&&$.each(r,function(n,s){a(e[t],s)||delete r[n]})}),r},this.generateMenu=function(e){return 0==e.template&&(e.template=void 0),e=$.extend(!0,{template:"{{#setPartial menu}}<ul>{{#each ~ as elName, el}}{{#if this.isDocObject}}<li><a href='#{{elName}}'>{{elName}}</a>{{#if this.Constructor}}<i style='font-size: 0.6em'>Constructor</i>{{/if}}</li>{{else}}<li class='group-{{elName}}'><h5>{{elName}}</h5>{{#partial menu, el}}</li>{{/if}}{{/each}}</ul>{{/setPartial}}{{#partial menu, ~}}"},e),this.generateHTML(e)},this.generateHTML=function(e,t){t=t||this.doc,e=e||{},e=$.extend(!0,{prettyprint:!1,el:!1,template:!1,anchorUrl:"{{LINK}}",lineBreaksToBreakTags:!0,onLoad:function(){return!1}},e);var r=this.toObject(e,t);r=this.createAnchorUrl(r,e.anchorUrl);var a="    <!-- param item -->\n   {{#setPartial param}}\n     <b class='param_name'>{{name}}</b> {{#if type}}\n           <i class='param_type'>({{type}})</i>\n      {{/if}} <span class='param_description'> <span class='param_hyphen'>-</span>  {{description}}</span> <span class='param_samplings samplings' style='font-size:.8em; padding-left: .6em;'>{{#if sample || default}}...{{#if sample}}<i>ex: </i> <b>{{sample}}</b>{{/if}}{{#if default}}<i> Default:</i> <b>{{default}}</b>{{/if}}{{/if}}</span> \n   {{/setPartial}}\n\n <!-- function item -->\n    {{#setPartial functionItem}}\n  <div class='function-item'>\n       <a id='{{~.name}}' name='{{~.name}}'></a>\n         <div class='function-header'>\n             <!-- constructor -->\n              <h2>{{~.name}}\n                    {{#if ~.Constructor==true}}\n                       <i class='constructor' style='font-size:.5em;'>Constructor</i>\n                    {{/if}}\n                   {{#if ~.property && ~.property!=true}}\n                        <i class='propertyType' style='font-size: .5em'>Property{{~.property}}</i>\n                    {{/if}}\n                   {{#if ~.returns}}\n                     <i class='returns' style='font-size:.5em;text-align:right; padding-left: .2em;display:inline-block;font-weight:normal'>Returns: <b>{{~.returns.type}}</b></i>\n                 {{/if}}\n               </h2>\n         </div>\n        </a>\n\n        <!-- properties-->\n        {{#if !~.property}}\n           <p class='function-format'><u><i>{{~.name}}\n\n             ({{#each ~.param}}\n                    {{#if ($FIRST && $LENGTH>1)}}\n                     {{#if this.optional}}\n                         [{{this.name}},]\n                      {{else}}\n                          {{this.name}},\n                        {{/if}}\n                   {{elif $LAST}}\n                        {{#if this.optional}}\n                         [{{this.name}}]\n                       {{else}}\n                          {{this.name}}\n                     {{/if}}\n                   {{else}}\n                      {{#if this.optional}}\n                         [{{this.name}},]\n                      {{else}}\n                          {{this.name}},\n                        {{/if}}\n                   {{/if}}\n               {{/each}})</i></u>\n            </p>\n      {{/if}}\n       <p class='function-description'>{{~.description}}</p>\n     <p class='function-params'></p>\n       <!-- params-->\n        <ul>\n          <li style='list-style: none'>\n         {{#each el.param}}</li>\n               <!-- do param typical setup-->\n                <li>{{#partial param, this}}</li>\n             <!-- subparams-->\n             <li style='list-style: none'>\n                 {{#if this.subparams}}\n                        <ul>\n                          <li style='list-style: none'>\n                             {{#each this.subparams as subparamName,subparamObj}}</li>\n                                 <li>{{#partial param, subparamObj}}</li>\n                                  <li style='list-style: none'>\n                             {{/each}}\n                         </li>\n                     </ul>\n                 {{/if}}\n           {{/each}}\n         </li>\n     </ul>\n     <p>\n           \n      </p>\n      <!-- return -->\n       {{#if ~.returns}}\n         <p class='function-returns'>\n              <b>Returns </b>\n                <i>({{~.returns.type}})</i> \n              -{{~.returns.description}}\n                {{#if  ~.returns.subparams}}\n             <ul>\n                  {{#each ~.returns.subparams as subparamName,subparamObj}}\n                     <li>{{#partial param, subparamObj}}</li>\n                  {{/each}}\n             </ul>\n             {{/if}}\n           </p>\n      {{/if}}\n       <!-- examples -->\n     {{#each ~.example}}\n           <h5 class='example_header'>Example{{$INDEX+1}}:{{this.id}}</h5><code class='lang-{{this.lang}}' style='white-space: pre'>{{#trim this.code}}</code>\n           <p></p>\n       {{/each}}\n </div>\n    {{/setPartial}}\n\n <!-- actual methods..sorted in groups -->\n <div class='functions-wpr'>\n       <!--RECURSVIE PARTIAL FOR GROUPS -->\n      {{#setPartial groups2}}\n           {{#log running groups2 with $~}}\n          {{#each ~ as elName,el}}\n              {{#if el.isDocObject}}\n                    {{#partial functionItem, el}}\n             {{else}}\n                  <h4 id='functionGroupHeader-{{elName}}' style='font-style: italic; text-transform: Capitalize'>{{elName}}</h4>\n                    <div class='functionGroup' id='functionGroup-{{elName}}' style='margin-left: 20px'>\n                       {{#partial groups2, el}}\n                  </div>\n                {{/if}}\n           {{/each}}\n     {{/setPartial}}\n       <!-- RUN DAT -->\n      {{#partial groups2, ~}}\n   </div>";e.template=e.template?e.template:a,e.lineBreaksToBreakTags&&(r.doc=this.lineBreaksToBreakTags(r.doc));var n=this.opts.templateEngine(e.template,r.doc,this);return e.el&&($(e.el).html(n),e.onLoad&&e.onLoad(e.el,r.doc,r.meta),void 0!=prettyPrint&&prettyPrint(),e.prettyprint||$(e.el).find("code").each(function(){$(this).hasClass("prettyprint")&&$(this).removeClass("prettyprint")})),n},this.generateMD=function(e){return e=$.extend({template:"{{#setPartial menu}} {{#each ~ as elName, el }}{{#if el.isDocObject}}\n  - [{{elName}}](#{{elName}}) {{#if el.Constructor}} *Constructor* {{/if}}{{else}}\n- **{{elName}}**{{#partial menu, el}}{{/if}}{{/each}}\n{{/setPartial}}\n\n\nYOURLIB.JS\n============\n\n*A library for [enter description here]*\n\n\n  ** *Menu* **  \n\n{{#partial menu, ~}} \n\n{{#setPartial param}}**{{name}}** {{#if type}}*{{type}}*{{/if}} - {{description}} {{#if sample || default}}... {{#if sample}}*e.g: * *{{sample}}*{{/if}}{{#if default}} *Default:* **{{default}}**{{/if}}{{/if}}{{/setPartial}}\n{{#setPartial functionItem}}\n\n<a name='{{~.name}}'></a>\n{{~.name}}\n-----\n---\n\n{{#if ~.Constructor == true}} *Constructor* {{/if}} {{#if ~.property && ~.property!=true }} \n*Property {{~.property}}*\n{{/if}} \n{{#if ~.returns}} \n#### Returns: *{{~.returns.type}}* \n{{/if}}\n\n\n{{#if !~.property}}\n```\n{{name}}({{#if paramNamesArr}}{{#join paramNamesArr, , }}{{/if}})\n```{{/if}}\n\n\n{{~.description}}\n\n{{#each el.param}}\n+ {{#partial param, this}} {{#if this.subparams}}{{#each this.subparams as subparamName,subparamObj}}\n  + {{#partial param, subparamObj}}{{/each}}{{/if}}{{/each}}\n{{#if ~.returns}}\n**Return -->** *{{~.returns.type}}* - {{~.returns.description}}\n{{#if  ~.returns.subparams}}{{#each  ~.returns.subparams as subparamName,subparamObj}}\n  + {{#partial param, subparamObj}}{{/each}}{{/if}}\n{{/if}}\n{{#each ~.example}}\n*Example {{$INDEX+1}}: {{this.id}}{{#if this.lang}} ({{this.lang}}){{/if}}*\n```{{this.lang}}\n{{#trim this.code}}\n ```\n{{/each}}\n{{/setPartial}}\n\n{{#setPartial groups2}}\n{{#log running groups2 with $~}}\n{{#each ~ as elName,el }}\n{{#if el.isDocObject}}\n{{#partial functionItem, el}}\n{{else}} #### >> {{elName}} {{#partial groups2, el}} {{/if}}\n{{/each}}\n{{/setPartial}}\n\n\n{{#partial groups2, ~}}",linkFormat:"[{{LINK}}](#{{LINK}})",lineBreaksToBreakTags:!0},e),this.generateHTML(e).replace(/(\r*\n){2,}/g,"\n\n")},this.toDataURIAnchorLink=function(e){var e=e||{};return e=$.extend({indent:3,fileName:"download.txt",content:""},e),$.isPlainObject(e.content)&&(e.content=JSON.stringify(e.content,null,e.indent)),"<a download='"+e.fileName+"' href='"+this._dataURI(e.content)+"'>"+e.fileName+"</a>"},this.eachLine=function(e,t){e=e||"";var r="",a=e.split("\n");return $.each(a,function(e,a){var n=t(a);n!==!1&&(r+=n+"\n")}),that.safeTrim(r)},this.removeBeginningAsterisks=function(e){var t=/\*\s*?/,r=this;return this.eachLine(e,function(e){return r.safeTrim(e).startsWith("*")?e.replace(t,""):e})},this.parseMeta=function(e,t){var r={},a=e.split(t);return $.each(a,function(e,t){0==e&&""==that.safeTrim(t)||e%2==1&&(r[t]=that.parseSubParams(a[e+1],"param"))}),r},this.parseJS=function(e){var t,r,a=/\/\*\*([.\s\S]+?)\*\//g,n=/\/\*\*(.+)\n([.\s\S]+?)\n+((?:\s)*@[.\s\S]+?)\*\//,s=/\/\*\*\s@META([.\s\S]+?)\*\//,i=/\/\*\*\s@SHARED([.\s\S]+?)\*\//,o=/^\s*@([a-zA-Z0-9-_]+)/gm;funcDic={};var c,l=this,u={};for(r=void 0;r=a.exec(e);){r[0]=r[0].replace(/-->/g,"[SUBPARAM_ARROW]").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(new RegExp("\\[SUBPARAM_ARROW\\]","g"),"-->"),r[0]=l.toggleEscapeCharsInObj(r[0],"escape");var t=n.exec(r[0]),p=s.exec(r[0]),m=i.exec(r[0]);p?$.extend(this.meta,this.parseMeta(p[1],o)):m?$.extend(this.shared,this.parseMeta(m[1],o)):t&&(u={},u.isDocObject=!0,u.name=l.safeTrim(l.toggleEscapeCharsInObj(t[1],"unescape")),u.description=this.removeBeginningAsterisks(t[2]),funcDic[u.name]=u,u.rest=t[3],u.rest=this.removeCommentLines(u.rest),u.rest=this.removeBeginningAsterisks(u.rest),u.rawPairs=[],c=u.rest.split(o),delete u.rest,$.each(c,function(e,t){0==e&&""==l.safeTrim(t)||e%2==1&&u.rawPairs.push({k:t,v:c[e+1]})}),funcDic[u.name]=$.extend(u,{}))}var h=l.rawPairsToDataObj(funcDic);return $.each(h,function(e,t){void 0!=t.property&&0!=t.property||void 0!=t.info&&0!=t.info||(h[e]["function"]=!0)}),h=l.toggleEscapeCharsInObj(h,"unescape")},this.stripWhiteSpaceAll=function(e){var t=function(e){return"string"==typeof e?e.trim().replace(/[\t\n\r]/g,"").replace(/\s+/," "):e};return this._forAll(e,function(e){t(e)},function(e,r){return{k:t(e),v:t(r)}})},this.stringToTypeAll=function(e){var t=this;return this._forAll(e,function(e){var r=!0;try{var a=$.parseJSON(e)}catch(n){r=!1}return/(?:true|false)/i.test(e.trim())?"true"==e.toLowerCase().trim():isNaN(Number(e.trim()))?r?t.stripWhiteSpaceAll(a):e:Number(e.trim())})},this._forAll=function(e,t,r,a,n){t=t||function(e){return e},r=r||function(e,r){return{k:e,v:"string"==typeof r?t(r):r}},a=a||function(e){return t(e)},n=n||function(e){return e};var s=this;if($.isArray(e)){var i=[];$.each(e,function(e,o){if("string"==typeof o)void 0!=t(o)&&i.push(t(o));else{var c=s._forAll(o,t,r,a,n);void 0!=c&&i.push(c)}})}else if("object"==typeof e){var i={};$.each(e,function(e,o){"string"==typeof o?(i[r(e,o).k]=r(e,o).v,void 0==i[r(e,o).k]&&delete i[r(e,o).k]):(i[r(e,o).k]=s._forAll(o,t,r,a,n),void 0==i[r(e,o).k]&&delete i[r(e,o).k])})}else if("string"==typeof e)var i=a(e);else var i=e;return i},this.parse={},this.flagParser={example:{id:function(e){return{id:e}},lang:function(e){return{lang:e}}},param:{optional:function(){return{optional:!0}},sample:function(e){return{sample:e}},"default":function(e){return{"default":e}}}},this.hashesToLinks=function(e,t){var r=/#([^\s]+)/g,a=this,n=/{{LINK}}|{{NAME}}/g;return t=t!==!0?t:"<a href='#{{LINK}}'>{{LINK}}</a>",this._forAll(e,function(e){for(var s,i=e;s=r.exec(e);)-1!=Object.keys(a.doc).indexOf(s[1])&&(i=i.replace(s[0],t.replace(n,s[1])));return i},function(e,s){for(var i,o=s;i=r.exec(s);)-1!=Object.keys(a.doc).indexOf(i[1])&&"code"!=e&&(o=o.replace(i[0],t.replace(n,i[1])));return{k:e,v:o}})},this.externalLinkify=function(e,t){var r,a=/\[(?!ex\.)(.+)\((.+)\)\]/g;return t=t!==!0?t:"<a target='_blank' href='{{LINK}}'>{{NAME}}</a>",this._forAll(e,function(e){for(var n=e;r=a.exec(n);)n=n.replace(r[0],t.replace(/{{LINK}}/g,r[2]).replace(/{{NAME}}/g,r[1]));return n},function(e,n){for(var s=n;r=a.exec(s);)"code"!=e&&(s=s.replace(r[0],t.replace(/{{LINK}}/g,r[2]).replace(/{{NAME}}/g,r[1])));return{k:e,v:s}})},this.lineBreaksToBreakTags=function(e){return this._forAll(e,null,function(e,t){var r=t;return"description"==e&&(r=r.replace(/(\r\n|\n|\r)/g,"<br/>")),{k:e,v:r}})},this.createAnchorUrl=function(e,t){var r=this,a=/{{LINK}}/g;t=t||"{{LINK}}";var n={};return $.each(e,function(e,s){"isDocObject"in s?(n[e]=s,n[e].anchorLink=t.replace(a,n[e].name)):n[e]=r.createAnchorUrl(s,t)}),n},this.paramStrToObj=function(e,t,r){t=t||"-",r=r||!1;var a={},n=new RegExp("([.\\s\\S]+?)"+t+"([.\\s\\S]+)");r&&(n=/([.\s\S]+)/g);var s,i=e,o={};if(s=n.exec(e)){i=s[1],a.description=that.safeTrim(s[2]),r&&(a.description=that.safeTrim(s[1]),i=that.safeTrim(s[1]));var c=that.extractSpecialData(i,"type");c.args&&(a.type=c.args),i=c.newText,r&&(a.description=i);var c=that.extractSpecialData(i,"flag");$.isEmptyObject(c.args)||($.each(c.args,function(e,t){void 0!=that.flagParser.param[e]?a=$.extend(a,that.flagParser.param[e](t)):o[e]=t}),a.flags=o),i=c.newText}return r?{k:that.makeID(),v:that.safeTrim(a)}:{k:that.safeTrim(i),v:that.safeTrim(a)}},this.makeID=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;5>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},this.extractSpecialData=function(e,t){var r={open:"flag"==t?/\[/:/\{/,close:"flag"==t?/\]/:/\}/},a=new this.ParentheticalMayhem(e,{debugMode:!1,openRegex:r.open,delimiterRegex:/,/,closeRegex:r.close,commandParsingLimit:1,disableSuffixContentParsing:!0}),n=a.getResultObject();if($.isPlainObject(n)){if("flag"==t){var s={};$.each(n.args,function(e,t){if(-1!=t.indexOf(":")){var r=t.split(":");s[that.safeTrim(r[0])]=that.safeTrim(r[1])}else s[that.safeTrim(t)]=!0})}else var i=n.args.join(", ").trim();return{args:"flag"==t?s:i,newText:(n.preText||"")+(n.suffixContent||"")}}return{args:"flag"==t?{}:!1,newText:e}},this.attType={example:[],param:[]},this.parse={Constructor:function(){return!0},property:function(e){return""!=that.safeTrim(e)?that.safeTrim(e):!0},info:function(){return!0},group:function(e){return that.safeTrim(e)},param:function(e){var t=that.paramStrToObj(e),r=t.v,a=t.k,n=that.parseSubParams(r.description,"param");return r.description=n.description,$.isEmptyObject(n.subparams)||(r.subparams=n.subparams),r.name=a,r},returns:function(e){var t=that.paramStrToObj(e,null,!0);if(void 0!=t.v){t=t.v;var r=that.parseSubParams(t.description,"param");$.isEmptyObject(r.subparams)||(t.subparams=r.subparams),t.description=r.description}return t},tags:function(e){return that.safeTrim(e)},example:function(e){var t={},r=that.extractSpecialData(e,"flag");return $.isEmptyObject(r.args)||($.each(r.args,function(e,r){void 0!=that.flagParser.example[e]&&(t=$.extend(t,that.flagParser.example[e](r)))}),t.flags=r.args),t.code=r.newText,t}},this.removeLinesWith=function(e,t){var r=that.raw,a=$.isArray(e);return a||(e=[e]),$.each(e,function(e,a){var n=new RegExp(a.replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"(.+)"),"g");r=that.eachLine(r,function(e){return n.test(e)?void 0!=t?e.replace(n,t.replace(/#MATCH#/g,e)):!1:e})}),r},this.toggleEscapeCharsInObj=function(e,t){var r,a=this,n={unescape:{"*":/\\\*/g,"/":/\\\//g,"@":/\\@/g,",":/\[COMMA\]/g,":":/\[COLON\]/g,"-":/\[HYPHEN\]/g},escape:{"[COMMA]":/\\,/g,"[COLON]":/\\:/g,"[HYPHEN]":/\\-/g}};if($.isPlainObject(e)||$.isArray(e)){if($.isArray(e)){r=[];var s;for(s=0;s<e.length;s++)r.push(!1)}else r={};$.each(e,function(e,n){r[e]=a.toggleEscapeCharsInObj(n,t)})}else"string"==typeof e?($.each(n[t],function(t,r){e=e.replace(r,t)}),r=e):r=e;return r},this.getSharedDataAndNewDescription=function(e){for(var t,r=/@@([^\s]+)/,a={},n={},s=0;t=r.exec(e);)if(s++,this.shared[t[1]]){var a=$.extend(!0,a,this.shared[t[1]]),i=a.description;delete a.description,e=e.replace(new RegExp("@@"+t[1],"g"),i)}return n=$.extend(n,a),{newDescription:e,resObj:n}},this.parseSubParams=function(e,t){var t=t||"basic",r={subparams:{}},a=that.eachLine(e,function(e){return-1!=e.indexOf("-->")?!1:e}),n=that.eachLine(e,function(e){return-1!=e.indexOf("-->")?e:!1});r.description=that.safeTrim(a);var s=$.extend({},this.getSharedDataAndNewDescription(r.description));return r.description=s.newDescription,"basic"==t||"param"==t?""!=that.safeTrim(n)&&$.each(n.split("\n"),function(e,a){"basic"==t?(subParamObj=a.split("-->"),r.subparams[subParamObj[0]]=subParamObj[1],r.subparams[subParamObj[0]].name=subParamObj[0]):"param"==t&&(subParamObj=that.paramStrToObj(a,"-->"),r.subparams[subParamObj.k]=subParamObj.v,r.subparams[subParamObj.k].name=subParamObj.k)}):"raw"==t&&(r.subparams=n),r=$.extend(!0,{},s.resObj,r)},this.generateOneAttributeObject=function(e,t){var r={};return r[e]=t,r},this.rawPairsToDataObj=function(e){var t=this;return $.each(e,function(r,a){$.each(a.rawPairs,function(a,n){var s=n.k,i=n.v;if(void 0!=t.parse[s]){var o=t.parse[s](i);void 0!=t.attType[s]?$.isArray(t.attType[s])?(void 0==e[r][s]&&(e[r][s]=[]),e[r][s].push(o)):$.isPlainObject(t.attType[s])?e[r][s]=$.extend(e[r][s],o):e[r][s]=o:e[r][s]=o}}),e[r].param&&(e[r].paramNamesArr=[],$.each(e[r].param,function(t,a){e[r].paramNamesArr.push(a.optional?"[,"+a.name+"]":a.name)})),delete e[r].rawPairs}),e},this.readJS=function(e){var t=this;$.ajax(e,{url:e,dataType:"text",success:function(e){t.raw=e,t.doc=$.extend({},t.parseJS(e)),opts.onSuccess($.extend({},t.doc),t)},error:function(e){opts.onError("Error reading "+this.url+": ",e.statusText)}})},this.simpleTmplParser=function(text,obj,extraData,intermParse){extraData=extraData||{};var that=this;intermParse=intermParse||!1,extraData._helpers=extraData._helpers||{};var helpersRegex=/([^0-9%$-+\/\*~!(\s]+)\((.*)\)/g,quoteRegex=/("(.*?)"|'(.*?)')/g,strLiteralRegex=/!!!(.+?)!!!/g;extraData._partials=extraData._partials||{};var _log=function(){return!1},toggleEscapeBracketsinObj=function(e,t){var r;if($.isPlainObject(e)||$.isArray(e)){if($.isArray(e)){r=[];var a;for(a=0;a<e.length;a++)r.push(!1)}else r={};$.each(e,function(e,a){r[e]=toggleEscapeBracketsinObj(a,t)})}else r="string"==typeof e?"escape"==t?e.replace(/\{\{/g,"[DOUBLE_BRACKET_OPEN]").replace(/\}\}/g,"[DOUBLE_BRACKET_CLOSE]"):e.replace(new RegExp("\\[DOUBLE_BRACKET_OPEN\\]","g"),"{{").replace(new RegExp("\\[DOUBLE_BRACKET_CLOSE\\]","g"),"}}"):e;return r},replaceHelperForRealFuncs=function(e){return e=e.replace(helpersRegex,function(e,t,r){return"extraData._helpers['"+t+"']("+replaceHelperForRealFuncs(r)+")"})},swapForTrueVars=function(e){var t;e=$(document.createElement("div")).html(e).text(),e=replaceHelperForRealFuncs(e);var r=[];e=e.replace(quoteRegex,function(t,a,n){_log("quoteRegex Results from ",e," to ---> ",t,a,n);var s=r.length;return r[s]=t,"!!!"+s+"!!!"});var a=e+"",n=/([a-zA-Z_~\.$@]+[-0-9.a-zA-Z_]*)/g,s=["true","false","extraData","obj"],i=["extraData."];return t=!1,a=a.replace(n,function(e){var t=!0;return $.each(i,function(r,a){e.substring(0,a.length)===a&&(t=!1)}),t&&-1==s.indexOf(e.toLowerCase())?(_log("looking up..",e),getVar(e,!0)):e}),a=a.replace(strLiteralRegex,function(e,t){return _log(e,"m1:",t),r[Number(t)]}),_log("newVarStr2 = ",e," to ",a),a},resolveStrToVal=function(str){str=str||"";var str=str.replace(/"/g,'"').replace(/'/g,"'");_log("obj:",obj),_log(obj.name),_log("resolving...",str);var expression=swapForTrueVars(str);return _log("we got..",expression),eval(expression)},throwError=function(e){throw this.SelectorException.prototype=Object.create(Error.prototype),new function(){Error.captureStackTrace(this),this.message=e,this.name="TemplateException"}},parseCmd=function(e,t){var r,a,n=function(r,a){var n=function(e,t){var r,a;if(void 0!=e&&e.constructor==RegExp)if(e.global)for(a=[];r=e.exec(t);)a.push(r);else a=e.exec(t);return a},s=i.indexOf(a.indexExclusive),o={cmdArgs:a.cmdArgs,text:void 0==t.endCmd?"":e.slice(i[s],i[s+1])};r==t.cmd?(t.cmdRegex&&(o.cmdMatches=n(t.cmdRegex,o.cmdArgs)),t.regex&&(o.matches=n(t.regex,o.text))):(t.extraCmdRegex&&(o.cmdMatches=n(t.extraCmdRegex[r],o.cmdArgs)),t.extraCmdRegex&&(o.matches=n(t.extraRegex[r],o.text)));for(var c=["cmdArgs","cmdMatches","matches"],l=0;l<c.length;l++)c[l]in o&&(void 0!=o[c[l]]&&0!=o[c[l]]||delete o[c[l]]);return o},s={segments:{}},i=[],o=0,c=0,l={startInclusive:0,endInclusive:0,startExclusive:0,endExclusive:0,segments:{}},u=!1;l.segments[t.cmd]={},void 0!=t.endCmd&&(t.extraSegments&&$.each(t.extraSegments.split(","),function(e,t){(a=/(.+)\*$/.exec(t))?l.segments[a[1]]=[]:l.segments[t]={}}),l.segments[t.endCmd]={}),startIndex=0;var p=new RegExp("{{\\s*("+Object.keys(l.segments).join("|")+")\\s*([^{\\n]*)\\s*}}","g");if(_log("balancingRegex: ",p),void 0==t.endCmd){u=!0,r=p.exec(e);var m={index:r.index,indexExclusive:r.index+r[0].length,val:r[0],cmd:r[1],cmdArgs:r[2]||!1};l.segments[r[1]]=m,l.startExclusive=r.index+r[0].length,l.startInclusive=r.index,l.endExclusive=r.index+r[0].length,l.endInclusive=r.index+r[0].length}for(;50>c&&0==u&&(r=p.exec(e))&&!(c>50);){if(r[1]==t.cmd?(0==c&&(l.startExclusive=r.index+r[0].length,l.startInclusive=r.index+0),o++):r[1]==t.endCmd&&o--,1==o&&-1!=Object.keys(l.segments).indexOf(r[1])&&t.endCmd!=r[1]||0==o&&t.endCmd==r[1]){var m={index:r.index,indexExclusive:r.index+r[0].length,val:r[0],cmd:r[1],cmdArgs:r[2]||!1};$.isArray(l.segments[r[1]])?l.segments[r[1]].push(m):(_log("level:",o),_log(r[1],m),l.segments[r[1]]=m),i.push(m.index),i.push(m.indexExclusive)}0==o&&t.endCmd==r[1]&&(l.endExclusive=r.index,l.endInclusive=r.index+r[0].length,s.all=e.slice(l.startExclusive,l.endExclusive),s.allIncludingCmd=e.slice(l.startInclusive,l.endInclusive),u=!0),c++}return $.each(l.segments,function(e,r){e!=t.endCmd&&($.isArray(r)&&r.length>0?(s.segments[e]=[],$.each(r,function(t,r){s.segments[e].push(n(e,r))})):$.isEmptyObject(r)||(s.segments[e]=n(e,r)))}),s.positions={start:{inclusive:l.startInclusive,exclusive:l.startExclusive},end:{inclusive:l.endInclusive,exclusive:l.endExclusive}},s.results=s.segments[t.cmd],s},getVar=function(v,justText){justText=justText||!1;var tmp=void 0,varblRegex=/^([a-zA-Z_~\.$@]+[-0-9.a-zA-Z_]*)$/g,fakeIndexRegex=/\.([0-9]+)/g;if(/\s/g.exec(v)||!v.match(varblRegex))return!1;if("~"==v)return justText?"obj":obj;v=v.replace(/~\./g,""),v=v.replace(fakeIndexRegex,function(e,t){return"["+t+"]"}),_log("pre tests for v = ",v),_log("extraData\n-----\n",extraData);try{void 0!=eval("obj."+v)&&(tmp=justText?"obj."+v:eval("obj."+v))}catch(e){}try{void 0==tmp&&void 0!=eval("extraData."+v)&&(tmp=justText?"extraData."+v:eval("extraData."+v))}catch(e){}return void 0==tmp&&(tmp=!1),tmp},newCommands={comment:{cmd:"!--",endCmd:"--",evaluate:function(){return""}},setPartial:{cmd:"#setPartial",endCmd:"/setPartial",evaluate:function(e){return extraData._partials[e.results.cmdArgs]=e.all,""}},replace:{cmd:"#replace",cmdRegex:/(.+),(.+),(.*)/,evaluate:function(data){var text=eval(swapForTrueVars(data.results.cmdMatches[1])),regexReplace=new RegExp(data.results.cmdMatches[2],"g");return text.replace(regexReplace,data.results.cmdMatches[3])}},partial:{cmd:"#partial",cmdRegex:/\s*(.+)\s*,\s*(.+)\s*/,evaluate:function(e){var t=e.results.cmdMatches[1],r=e.results.cmdMatches[2];return void 0!=extraData._partials[t]?(_log("running partial:",t,extraData._partials[t]),that.simpleTmplParser(extraData._partials[t],getVar(r),extraData,!0)):""}},log:{cmd:"#log",evaluate:function(e){return e.results.cmdArgs=e.results.cmdArgs.replace(/(^|\s)\$([^\s]+)/g,function(e){return JSON.stringify(getVar(e[2]))}),_log("SOULPATCH LOG: "+e.results.cmdArgs),""}},join:{cmd:"#join",cmdRegex:/\s*([^,]+)\s*(?:,\s*(.+))?/,evaluate:function(data){var el=data.results.cmdMatches[1],delimiter=data.results.cmdMatches[2];return _log("joining:",swapForTrueVars(el)),eval(swapForTrueVars(el)).join(delimiter)}},If:{cmd:"#if",endCmd:"/if",extraSegments:"elif*,else",evaluate:function(data){var segments=data.segments,test,returnText="";return""==returnText&&segments["#if"]&&(_log("segments found",swapForTrueVars(segments["#if"].cmdArgs)),test=eval(swapForTrueVars(segments["#if"].cmdArgs)),test&&(returnText=segments["#if"].text)),""==returnText&&segments.elif&&$.each(segments.elif,function(k,v){""==returnText&&(test=eval(swapForTrueVars(v.cmdArgs)),test&&(returnText=v.text))}),""==returnText&&segments["else"]&&(returnText=segments["else"].text),_log("if data from evaluate",data),_log("returnTxt",returnText),returnText}},each:{cmd:"#each",endCmd:"/each",cmdRegex:/\s*(.+)\s+as\s+(.+)\s*/,evaluate:function(e){var t,r="";t={};var a,n,s;if(e.results.cmdMatches?(tmpObj=getVar(e.results.cmdMatches[1]),e.results.cmdMatches[2]&&(tmpObj=getVar(e.results.cmdMatches[1]),s=e.results.cmdMatches[2].split(","),-1!=e.results.cmdMatches[2].indexOf(",")?(a=s[0].trim(),n=s[1].trim()):n=e.results.cmdMatches[2].trim())):tmpObj=getVar(e.results.cmdArgs),_log("tmpObj is ",tmpObj),tmpObj){var i=0;$.each(tmpObj,function(s,o){t["this"]=o,a&&(t[a]=s),n&&(t[n]=o),t.$LENGTH=Object.keys(tmpObj).length,t.$INDEX=Number(i),t.$COUNT=Number(i)+1,t.$LAST=Object.keys(tmpObj).length-1==i,t.$FIRST=0==i,r+=that.simpleTmplParser(e.results.text,obj,$.extend($.extend({},extraData),t),!0),i++,_log("newExtraData is",t)})}return r}},boldify:{cmd:"#boldify",evaluate:function(e){return"<b>"+getVar(e.results.cmdArgs)+"</b>"}},underlineify:{cmd:"#underlineify",evaluate:function(e){return"<u>"+resolveStrToVal(e.results.cmdArgs)+"</u>"}},boldifyContents:{cmd:"#boldifyContents",endCmd:"/boldifyContents",evaluate:function(e){return"<b>"+e.results.text+"</b>"}},trim:{cmd:"#trim",evaluate:function(e){return resolveStrToVal(e.results.cmdArgs).trim()},helperEvaluate:function(){return"trimmmmmed..."+arguments[0].trim()}},set:{cmd:"#set",evaluate:function(e){if(-1==e.results.cmdArgs.indexOf("="))return"";var t=e.results.cmdArgs.split("=",2);return obj[t[0].trim()]=obj[t[0].trim()]||{},_log("pieces",t),obj[t[0].trim()]=resolveStrToVal(t[1]),""}},jsonify:{cmd:"#jsonify",evaluate:function(e){return _log("woooooop"),_log("jsonifying",e.results.cmdArgs," to ",resolveStrToVal(e.results.cmdArgs)),JSON.stringify(resolveStrToVal(e.results.cmdArgs))}}};$.each(newCommands,function(e,t){t.helperEvaluate=t.helperEvaluate||!1,t.helperEvaluate&&$.isFunction(t.helperEvaluate)?extraData._helpers[t.cmd]=t.helperEvaluate:t.helperEvaluate&&$.isString(t.helperEvaluate)||(extraData._helpers[t.cmd]=function(){extraData._helperArgs=[];var e="";arguments[0]=arguments[0]||"",arguments[1]=arguments[1]||"",arguments[2]=arguments[2]||"";for(var r=0;r<arguments.length;r++)extraData._helperArgs.push(arguments[r]);if(e+="{{"+t.cmd+" _helperArgs.0}}",!t.endCmd||void 0!=t.extraSegments&&0!=t.extraSegments){if(t.endCmd&&t.extraSegments){e+=arguments[2];for(var r=3;r<arguments.length;r+=3)-1!=t.extraSegments.split().indexOf(r.trim())&&(arguments[r+1]=arguments[r+1]||"",arguments[r+2]=arguments[r+2]||"",e+="{{"+r.trim()+" "+arguments[r+1]+"}}",e+=arguments[r+2])}}else e+=arguments[1];t.endCmd&&(e+="{{"+t.endCmd+"}}"),_log(extraData._helperArgs),_log("text from "+t.cmd+":",e);var a=that.simpleTmplParser(e,obj,extraData,!0);return a})});var commandRegex=/\{\{\s*([^\}\s]+)\s*([^\}]+)*\s*\}\}/,hbRegex=/\{\{\s*(.+)\s*\}\}/,noMoreCommands=!1,commandMatch,newText=text;for(obj=toggleEscapeBracketsinObj(obj,"escape");0==noMoreCommands;){if(noMoreCommands=!0,(commandMatch=commandRegex.exec(text))&&(_log("m[1] = "+commandMatch[1]),commandMatch)){var cmdFound=!1,RESULT="",parseData;if($.each(newCommands,function(e,t){_log(t.cmd+" = "+commandMatch[1]+"?"),that.safeTrim(t.cmd)==commandMatch[1]&&0==cmdFound&&(_log("read as a cmd?"),parseData=parseCmd(text,t),_log("\n-----\n"),_log(parseData),RESULT=that.simpleTmplParser(t.evaluate(parseData),obj,extraData,!0),_log("new text\n-----\n"+text+"\n---end new text--\n"),cmdFound=!0,noMoreCommands=!1)}),0==cmdFound){parseData={positions:{start:{inclusive:commandMatch.index},end:{inclusive:commandMatch.index+commandMatch[0].length}}};var insides=hbRegex.exec(commandMatch[0]);if(_log("BAMBAM INSIDES:",insides,"current RESULT:",RESULT),
void 0!=getVar(insides[1])&&0!=getVar(insides[1]))_log("BAMBAM: read as a variable? '"+getVar(insides[1])+"'"),RESULT=getVar(insides[1]);else try{_log("BAMBAM:",extraData,insides[1]," = ",swapForTrueVars(insides[1])),RESULT=resolveStrToVal(insides[1]),_log("BAMBAM RES-->:",RESULT)}catch(e){for(var prop in e)vDebug+="property: "+prop+" value: ["+err[prop]+"]\n";_log("unknown cmd. stripping.."),_log("Parse Exception  --> "+e),_log("Stack:",e.stack)}noMoreCommands=!1}_log("woop"),text=text.slice(0,parseData.positions.start.inclusive)+RESULT+text.slice(parseData.positions.end.inclusive)}if(1==noMoreCommands)return intermParse||(text=toggleEscapeBracketsinObj(text,"unescape")),text}},this.ParentheticalMayhem=function(e,t){this.opts=t||{},this.opts=$.extend(!0,{openRegex:/([^,\s]+?|\s?)\(/,delimiterRegex:/,/,closeRegex:/\)/,debugMode:!1,commandParsingLimit:0,disableSuffixContentParsing:!1,mapper:function(){return{}}},this.opts),this.resultObject={},this.load=function(e){this._log('loading string.."',e,'"'),void 0!=e&&(this.resultObject=this.parseString(e))},this.getResultObject=function(){return"string"==typeof this.resultObject?this.resultObject:$.extend(!0,{},this.resultObject)},this.toTextFormat=function(e,t,r){var a=this,e=e||{},t=t||this.getResultObject(),r=void 0!=r?r:0,e=$.extend(!0,{plainText:function(e,t){return t},preText:function(e,t){return t},suffixContent:function(e,t){return t},commands:{_default:function(e,t){return t.command+"("+t.args.join(", ")+")"}}},e),n="";if("string"==typeof t)n=e.plainText(r,t);else{if(r++,void 0!=t.preText&&(n+=e.preText(r,t.preText)),void 0!=t.command){var s=void 0!=e.commands[t.command]?e.commands[t.command]:e.commands._default;$.each(t.args,function(n,s){"string"!=typeof s&&(t.args[n]=a.toTextFormat(e,s,r))}),n+=s(r,t,s)}void 0!=t.suffixContent&&("string"!=typeof t.suffixContent&&(t.suffixContent=a.toTextFormat(e,t.suffixContent,0)),n+=e.suffixContent(r,t.suffixContent))}return n},this._log=function(){this.opts.debugMode&&console.log.apply(null,arguments)},this.withinCommandLimit=function(e){return this.opts.commandParsingLimit>0?this.opts.commandParsingLimit>e:!0},this.parseString=function(e,t){for(var r=e,a=this,n={open:{regex:a.opts.openRegex},comma:{regex:a.opts.delimiterRegex},close:{regex:a.opts.closeRegex}},t=t||1,s=!0,i=0,o=0,c=0,l=0,u={openMatches:[],closeMatches:[],delimiterMatches:[],preText:"",suffixContent:"",args:[]},p={preText:"",command:"",args:[],suffixContent:""};1==s;){s=!1;var h=!1,f=!1,d=-1;if($.each(n,function(t,r){r.regex&&((m=r.regex.exec(e))?(m.index<d||-1==d)&&(h=m,f=t,d=m.index):a._log(t,": no matches :("))}),h){if(o=h.index+h[0].length,l+=o,this._log("-----------------"),this._log("match for  "+f+".."),this._log("match found!",f,h),this._log("lastArgPosition:",c),this._log("absolute index:",l),this._log("nextPosition",o),this._log("absolute text from here:",r.substring(l)),this._log("nested index:",i),"open"==f)0==i&&(p.preText=r.substring(0,h.index),u.preText=p.preText,u.openMatches=h,p.command=h[1]||"",c=l),i++;else if("comma"==f&&1==i){var g=r.substring(c,l-h[0].length);this._log("new arg!:",g),u.delimiterMatches.push(h),this.withinCommandLimit(t)?p.args.push(this.parseString(g,t+1)):p.args.push(g),c=l}else if("close"==f&&(i--,this._log("close found nestedIndex now:",i),0==i)){p.suffixContent=r.substring(l),this.opts.disableSuffixContentParsing||(p.suffixContent=this.parseString(p.suffixContent,t)),u.suffixContent=p.suffixContent,this._log("suffix content:",p.suffixContent);var g=r.substring(c,l-h[0].length);this._log("new arg!:",g),u.closeMatches=h,this.withinCommandLimit(t)?p.args.push(this.parseString(g,t+1)):p.args.push(g),this._log("mapperData:",u),u.args=$.extend(!0,{},p.args);var x=this.opts.mapper(u);$.extend(!0,p,x);var v=["suffixContent","preText"];for(var b in v)key=v[b],"string"==typeof p[key]&&""==p[key].replace(/[\n\r\s]+/g,"")&&delete p[key];return $.each(x,function(e,t){void 0!=p[e]&&void 0==t&&delete p[e]}),p}e=e.substring(o),s=!0}}return r},this.load(e)},this.init()}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var a=r.indexOf(e,t);return-1!==a&&a===t}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});